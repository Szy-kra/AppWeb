@model AppWeb.Application.DataTransferObject.CottageDto

<h1 class="text-sun">Dodaj swój Domek do naszej społeczności</h1>
<hr class="border-success" />

<form asp-action="Create" enctype="multipart/form-data" method="post">
    @* Główny kontener dwóch kolumn *@
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: stretch;">

        @* LEWA KOLUMNA (Pola tekstowe) *@
        <div class="d-flex flex-column justify-content-between">

            <div class="form-group mb-3">
                <label asp-for="Name" class="form-label">Nazwa Domku</label>
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Description" class="form-label">Opis</label>
                <input asp-for="Description" class="form-control" />
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="About" class="form-label">Szczegóły</label>
                <input asp-for="About" class="form-control" />
                <span asp-validation-for="About" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="MaxPersons" class="control-label">Maksymalna liczba osób</label>
                <input asp-for="MaxPersons" class="form-control" />
                <span asp-validation-for="MaxPersons" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Price" class="control-label">Cena za dobę [zł]</label>
                <input asp-for="Price" class="form-control" />
                <span asp-validation-for="Price" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Street" class="control-label">Ulica / Adres</label>
                <input asp-for="Street" class="form-control" />
                <span asp-validation-for="Street" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="City" class="form-label">Miasto</label>
                <input asp-for="City" class="form-control" />
                <span asp-validation-for="City" class="text-danger"></span>
            </div>

            <div class="form-group mb-0">
                <label asp-for="PostalCode" class="form-label">Kod pocztowy</label>
                <input asp-for="PostalCode" class="form-control" />
                <span asp-validation-for="PostalCode" class="text-danger"></span>
            </div>

        </div>

        @* PRAWA KOLUMNA (Siatka zdjęć) *@
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 15px;">
            @for (int i = 1; i <= 6; i++)
            {
                <div class="card bg-dark text-white border-secondary h-100 position-relative"
                     style="border-style: dashed; border-width: 2px; overflow: visible;">

                    <label for="file-@i" class="card-body d-flex flex-column align-items-center justify-content-center p-0 text-center"
                           style="cursor: pointer; min-height: 140px;">

                        <div id="content-@i">
                            <span class="small mb-1 fw-bold d-block">Zdjęcie @i</span>
                            <div style="opacity: 0.5; font-size: 1.5rem;">➕</div>
                        </div>

                        <img id="preview-@i" src="#" alt="Podgląd"
                             style="display: none; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; border-radius: 4px;" />

                        <input type="file" name="ImageFiles" id="file-@i" class="form-control d-none"
                               accept="image/*" onchange="previewImage(this, @i)" />
                    </label>
                </div>
            }
        </div>
    </div>

    @* Przycisk Zapisz *@
    <div class="row mt-4">
        <div class="col-md-6">
            <button type="submit" class="btn-nature w-100 fw-bold shadow-sm py-3" style="font-size: 1.1rem;">
                Zapisz i opublikuj domek
            </button>
        </div>
    </div>
</form>

@section Scripts {
    @* 1. Biblioteki walidacji MUSZĄ być wewnątrz sekcji Scripts i przed Twoim kodem JS *@
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        /**
         * Logika podglądu zdjęć
         */
        function previewImage(input, index) {
            const preview = document.getElementById('preview-' + index);
            const content = document.getElementById('content-' + index);
            const container = input.closest('.card');

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';

                    if (content) content.style.display = 'none';

                    let oldBtn = container.querySelector('.action-btn-remove');
                    if (oldBtn) oldBtn.remove();

                    const btn = document.createElement('div');
                    btn.innerHTML = '×';
                    btn.className = 'action-btn-remove';

                    btn.onclick = function (event) {
                        event.preventDefault();
                        event.stopPropagation();

                        input.value = "";
                        preview.src = "#";
                        preview.style.display = 'none';

                        if (content) content.style.display = 'block';

                        this.remove();
                    };

                    container.appendChild(btn);
                };

                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
   
}